// Generated by CoffeeScript 1.6.3
(function() {
  var _this = this;

  angular.module('angularDcjsApp').controller('MainController', [
    '$scope', 'Debug', 'dataAPI', function($scope, Debug, dataAPI) {
      $scope.measures = [];
      $scope.dimensions = [];
      $scope.getLog = function() {
        return Debug.output();
      };
      $scope.retrieveData = function() {
        dataAPI.getData().then(function(response) {
          $scope.rows = response.data;
          $scope.identifyHeaders(response.data);
        });
      };
      $scope.identifyHeaders = function(data) {
        $scope.getParams(data, 'Datetime');
        $scope.getParams(data, 'Dimension');
        return $scope.getParams(data, 'Measure');
      };
      $scope.getParams = function(data, index) {
        var items, pattern;
        if (data && index) {
          items = [];
          pattern = new RegExp(index.toUpperCase() + ':(.*)');
          angular.forEach(data[0], function(value, key) {
            var input;
            input = key.match(pattern);
            if (input) {
              return items.push(input[1]);
            }
          });
          if (items.length > 0) {
            $scope[index] = items;
            return Debug.input({
              name: index,
              'items': items
            });
          }
        }
      };
      return $scope.retrieveData();
    }
  ]);

}).call(this);

/*
//@ sourceMappingURL=main.map
*/
